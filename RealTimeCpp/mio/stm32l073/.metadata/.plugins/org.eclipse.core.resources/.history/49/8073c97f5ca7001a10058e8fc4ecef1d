/**
 ******************************************************************************
 * @file    main.c
 * @author  Auto-generated by STM32CubeIDE
 * @version V1.0
 * @brief   Default main function.
 ******************************************************************************
 */

#if !defined(__SOFT_FP__) && defined(__ARM_FP)
  #warning "FPU is not initialized, but the project is compiling for an FPU. Please initialize the FPU before use."
#endif

#include <cstdint>
#include "main.h"

class led {
public:
	// Use convenient class-specific typedefs.
	typedef std::uint8_t port_type;
	typedef std::uint8_t bval_type;

	// The led class constructor.
	led(const port_type p, const bval_type b) :
			port(p), bval(b) {
		// Set the port pin value to low.
		*reinterpret_cast<volatile bval_type*>(port) &=
				static_cast<bval_type>(~bval);

		// Set the port pin direction to output.

		// Note that the address of the port direction
		// register is one less than the address
		// of the port value register.
		const port_type pdir = port - 1U;

		*reinterpret_cast<volatile bval_type*>(pdir) |= bval;
	}

	void toggle() const {
		// Toggle the LED via direct memory access.
		*reinterpret_cast<volatile bval_type*>(port) ^= bval;
	}

private:
	// Private member variables of the class.
	const port_type port;
	const bval_type bval;
};

int main(void) {
	/*	User LD2: the green LED is a user LED connected to Arduino signal D13 corresponding to
	 STM32 I/O PA5 (pin 21) or PB13 (pin 34) depending on the STM32 target
	 */
	RCC->IOPENR |= RCC_IOPENR_IOPAEN;
	GPIOA->MODER &= ~(GPIO_MODER_MODE5_1); //~(GPIO_MODER_MODE5_0 | GPIO_MODER_MODE5_1);
	GPIOA->MODER |= GPIO_MODER_MODE5_0;
	GPIOA->OTYPER &= ~(GPIO_OTYPER_OT_5);
	GPIOA->ODR |= GPIO_ODR_OD5;
	for (;;)
		;
}
